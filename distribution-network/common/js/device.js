const app = getApp() //获取应用实例
import {
  deviceImgMap
} from '../../../utils/deviceImgMap'
import {
  deviceImgApi
} from '../../../api'
import config from '../../../config.js'
import {
  cloudDecrypt
} from 'm-utilsdk/index'
import {
  filterList
} from '../../../utils/pluginFilter.js'
// import { imgCdnUrl } from '../../../api' //只有colmo有，无法兼容
// import host from '../../../configs/host' //只有colmo有，无法兼容
// import getEnv from '../../utils/getEnv' //只有colmo有，无法兼容
const environment = config.environment
const imgPrefix = config.imgPrefix[environment]
let imgCdnUrl = {
  url: 'https://pic.mdcdn.cn/h5/img/colmomini'
}
const brandConfig = app.globalData.brandConfig[app.globalData.brand]
const oldColmoSn8List = brandConfig.allSN8List
const oldColmoSn8List_backup = { // 全量colmo设备sn8名单 兼容sn品牌码对不上的旧colmo设备
  '0x46': {
    sn8: [ // 衣物护理柜
      '38100HW8',
      // '38700HW8', 
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/46_1.png`
  },
  '0x9B': {
    sn8: [ // 蒸汽烤箱
      '71100002', '70100003', '71100003',
      // '71100002', '71100003'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/9B_1.png`
  },
  '0xA1': {
    sn8: [ // 除湿机
      '20104019', '20104018'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/A1_1.png`
  },
  '0xAC': {
    sn8: [ // 空调
      '22259039', '222Z1555', '22019045', '220Z1553', '222Z1466', '22259037', '22259035', '22259019', '222Z1548', '22396927', '22396945', '22396939', '22396935', '22396941', '22396943', '22396933', '22396937', '22259029', '222Z1468', '222Z1543', '22259015', '22259021', '22259011', '22019023', '22019003', '220Z1352', '22259023', '22019001', '22259033', '22259025', '222Z1545', '22019021', '222Z1485', '220Z1339', '222Z1546', '222Z1486', '220Z1453', '220Z1530', '220Z1540', '220Z1527', '22019033', '22019043', '22019041', '220Z1336', '220Z1406', '220Z1467', '22012211', '220Z1464', '22019025', '220Z1549', '220Z1550', '22019035', '22019031', '22019029', '22019027', '22019039', '22019037', '222Z1450', '22259031', '22259013', '22259027', '222Z1544', '22259017', '222Z1465', '222Z1547', '26096951', '26096947', '26096955', '22396915', '23096949', '26096913', '26096911', '10696931', '10296951', '22396923', '230Z1484', '22396925', '22396917', '22396921', '22396929', '22396919', '26096931', '22251025', '22259001', '222Z1353', '222Z1430', '22259007', '222Z1429', '222Z1329', '222L9996', '222Z1354', '22259009', '222Z1340', '230Z2316', '223PD038'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/AC_1.png`
  },
  '0xB1': {
    sn8: [ // 大烤箱
      '71100001', '000CTC50', '70000001',
      // '70000001', '000CTC50', '71100001'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/B1_1.png`
  },
  '0xB2': {
    sn8: [ // 蒸汽炉
      '70100001', '000CSK50', '00CSKA50', '70100002',
      // '000CSK50', '70100001'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/B2_1.png`
  },
  '0xB6': {
    sn8: [ // 抽油烟机
      'CXEP1022', 'JD922SE5', 'JP922SE5', 'JP922WE6', 'EP922WE6', 'XKP924W8', 'XSP924W8', '73000684', '7300068C', '730NEWE5', '7300068K', '73000688', '7300068B', 'XJP924W8', '7300068M', '7300068V', '73000687', '7300TULN', '73000S67', '7300068J', '73000010', '73000683', '73000685', '73000686', '7300068D', '7300068A', '73000S83', '7300068S', '7300068P', '7300S81E', '73000S81', '73001S83', '7300S83B', '73000S72', '7300S72G', '7300068Y',
      // 'XKP924W8', 'JD922SE5', '7300068S', '7300068P', '73000683', '7300068C', 'XJP924W8', '730NEWE5'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/B6_1.png`
  },
  '0xB7': {
    sn8: [ // 灶具
      '6620052F'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/B7_1.png`
  },
  '0xB9': {
    sn8: [ // 多头灶(电磁灶)
      '665000VR'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/B9_1.png`
  },
  '0xC8': {
    sn8: [ // 酒柜
      '330Q0430'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/C8_1.png`
  },
  "0xCA": {
    sn8: [ // 冰箱
      '001A1112', '310A1112', '310A1162', '001A0896', '310A0896', '310A1244', '310A1037', '310A1243', '310A1242', '001A1158', '310A1158', '001A1159', '310A1159', '001A1160', '310A1160', '001A0891', '310A0891', '001A0958', '310A0958', '310A1175', '001A1175', '001A0665', '310A0665', '310A1174', '001A1174', '001A1211', '310A1211', '310A1163', '001A1212', '310A1212', '001A1213', '310A1213', '001A1214', '310A1214', '001A1215', '310A1215', '001A1115', '310A1115', '001A1116', '310A1116', '001A1117', '310A1117', '001A1119', '310A1119', '001A1118', '310A1118', '001A1120', '310A1120', '310A1297', '001A1122', '310A1122', '310A1298', '310A1121', '001A1121', '310A1390', '310A1391', '310A1392', '310A1393', '310A1387', '310A1388', '001A1143', '310A1143', '310A1389', '001A1142', '310A1142',
      // '310A1037', '310A1297', '310A1243', '310A1121', '001A1212', '001A1160', '310A1388', '001A1122', '001A1120', '001A1118', '001A1112', '310A1212', '310A1213', '310A0665', '310A1244', '310A1116', '001A1213', '310A1122', '001A0891', '310A0958', '310A1160', '001A1121', '310A1158', '001A1115', '310A1120', '310A1387', '310A1390', '001A0665', '310A1214', '001A0958', '310A1112', '310A1298', '001A1175', '001A1215', '310A0891', '001A1158', '001A1119', '001A1174', '310A1175', '310A1118', '310A1119', '310A1159', '310A1242', '001A1117', '001A1211', '310A1162', '310A0896', '310A1392', '001A1159', '310A1211', '310A1174', '001A1214', '310A1117', '310A1215', '001A1116', '310A1163', '310A1391', '310A1389', '310A1393', '001A0896', '310A1143', '001A1143', '001A1142', '310A1142', '001A1037', '310A1115',
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/CA_1.png`
  },
  '0xD9': {
    sn8: [ // 复式
      '38126913', '38126914', '38122839', '38122247', '38120540', '38120543', '38123327', '38124786', // 电控
      // '38100JM0', '38100JL9', '38100JL9', '38120543', '38122247', '99990000', '38100HT6'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/D9_1.png`
  },
  '0xDA': {
    sn8: [ // 波轮
      '38034068', '38032103',
      // '38000JJ6'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/DA_1.png`
  },
  '0xDB': {
    sn8: [ // 滚筒
      '38127210', '38127190', '38127171', '38119729', '38122547', '38122546', '38116285', '38118044', '38118103', '38124534', '38125478', '38125488', '38123159', '38123156', '38123685', '38128832', '38129010', '38128833', '38128809', '38129330', '38129328', '38129333'
      // '38100JV4', '38100JW1', '38100JW2', '38100HN1', '38100HN0', '38100HM8', '381B1043', '38100JP7', '38100JL0', '38100HG3', '38100JM3', '38100HT7', '38100JF0', '38100JL4', '38100HM9', '38132717'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/DB_1.png`
  },
  '0xDC': {
    sn8: [ // 干衣机
      '38206183', '38206174', '38126399', '38204201', '38204861', '38205849', '38205141', '38207082', '38207283', '38207212', '38128573', '38128693'
      // '38200JY7', '38204344', '38204201', '38200JM1', '382B1044', '38200JF1', '38205849', '382B1044', '38200JM9', '38200JM1', '38206183', '38206174', '38200JM9'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/DC_1.png`
  },
  "0xE1": {
    sn8: [ //洗碗机
      '76000019', '760B108B', '76000014', '760DB312', '760CDB31', '7600001F', '760DB412', '76000103', '000000E8', '760FB212', '7600001E', '76000102', '76000101', '7600001D', '000000E6', '76000013', '00W9601B', '760Y0007', '760Y0006', '7600001A',
      // '760Y0007', '76000019', '76000014', '760DB312', '760CDB31', '7600001F', '760DB412', '76000103', '000000E8', '760FB212', '7600001E', '76000102', '76000101', '76000013', '760Y0006', '7600001A', '00W9501B', '000000E6', '7600001D'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/E1_1.png`
  },
  "0xE2": {
    sn8: [ //电热水器
      '51032GQ3', '51001109', '51001106', '51001108', '51001107', '51001104', '51001105', '51050FT3', '51001112', '51001115', '51030LQ3', '51001116', '51001121', '51001117', '51001122', '51030LS5', '510Q4032', '510V5032', '510C5032', '51001110', '51001111', '51001119', '51001120', '51050HE1', '51001125', '51001128', '5100GQ43', '51001129', '5100112D', '5100112A', '5100112E', '5100112K', '5100112L', '5100112B', '5100112C', '5100112F', '5100112G', '5100112J', '5100112H', '5100112M', '5100112N', '5100112R', '5100112Q', '5100112S', '5100112P', '5100112W', '5100112V', '5100112T', '5100112U', '5100112X', '5100112Y', '5100112Z', '51001130', '51001132', '51001131', '51001135', '51001137', '51001136', '51001133', '51001134', '5100113C', '5100113D', '5100113A', '5100113B', '51001138', '51001139', '5100113F', '5100113E', '5100113H', '5100113G', '5100113L', '5100113J', '5100113T', '5100113Q', '5100113N', '51001141', '51001142', '51001140', '5100113W', '5100113Z',
      // '5100113L', '5100113J', '5100113T', '5100113Q', '5100113N', '51001141', '51001142', '51001140', '5100113W', '5100113Z', '51001109', '51001106', '51001108', '51001107', '51001104', '51001105', '51050FT3', '51001112', '51001115', '51001116', '51001121', '51001117', '51001122', '51030LS5', '510V5032', '51001110', '51001111', '51001119', '51001120', '51050HE1', '51001125', '51001128', '5100GQ43', '51001129', '5100112D', '5100112A', '5100112E', '5100112K', '5100112L', '5100112B', '5100112C', '5100112F', '5100112G', '5100112M', '5100112N', '5100112R', '5100112Q', '5100112S', '5100112P', '5100112W', '5100112V', '5100112T', '5100112U', '51001132', '51001131', '5100113L', '5100113J', '5100113T', '5100113Q', '51032GQ3', '5100113D', '5100113C', '5100112X', '5100112Y', '51001135', '51001134', '51001133', '51001130', '51030LQ3', '5100112Z', '5100112H', '5100112J', '51001136', '510Q4032', '51001137', '5100113F', '5100113E', '5100113G', '5100113H', '510C5032', '51001138', '5100113B', '5100113A', '51001139',
      // '51032FQ3',
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/E2_1.png`
  },
  "0xE3": {
    sn8: [ // 燃气热水器
      '511CE616', '511CB216', '51100CE6', '511CX313', '51100018', '5110002A', '5110002B', '51100029', '51100028', '51100021', '5110001Z', '51100020', '51100022', '51100027', '51100026', '51100024', '5110001Y', '5110001X', '5110001B', '5110001A', '5110001H', '5110001F', '5110001E', '5110001C', '5110001D', '5110001R', '5110001U', '5110001T', '5110001Q', '5110001S', '51100025', '51100023', '5110001M', '5110001W', '5110001V', '5110001N', '5110001P', '51100019', '511CX916', '511CB316', '51100CX9', '5110001J', '51100CX5', '511CW616', '511CX516', '511CC516', '511CX316', '51100CW6', '5110002D', '5110002C', '5110002F', '5110002G', '5110002H', '5110002J',
      // '5110001H', '5110001C', '511CE616', '51100CE6', '5110001E', '5110001F', '5110001P', '51100CX5', '511CX516', '51100021', '511CX313', '511CW616', '51100CW6', '5110001B', '5110002H', '5110002J', '51100026', '51100027', '51100025', '5110001U', '5110001T', '51100023', '5110001W', '5110001Z', '51100022', '5110002D', '5110001X', '5110002C', '5110002F', '51100020', '5110001V', '5110002G', '5110001Y', '5110001R', '51100018', '51100019', '5110001M', '5110001Q', '5110001A', '5110001S', '511CX916', '511CB316', '51100CX9', '5110001N', '5110001D', '5110002A', '511CC516', '51100024', '511CX316', '5110002B', '5110001J', '51100029', '51100028', '511CB216', '51100CB2'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/E3_1.png`
  },
  "0xE6": {
    sn8: [ // 壁挂炉
      '27600001', '27600002', '27600003', '27600004', '27610147', '27610148', '27610149', '2761014A',
      // '27610147', '2761014A', '27610149', '27610148', '27600004', '27600002', '27600003', '27600001', '27600009'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/E6_1.png`
  },
  '0xEA': {
    sn8: [ // 电饭煲
      '61000565',
      // '0000002E'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/EA_1.png`
  },
  '0xED': {
    sn8: [ // 净饮设备
      '63100001', '63200848', '63200849', '63200851', '63200B16', '63200A75', '63200B14', '632A0A63', '63200A63', '63200A95', '63200A05', '63200A61', '63200A97', '63200A06', '6320B139', '6320B105', '6320084F', '6320084M', '6320084N', '6320084L', '6320084P', '6320084W', '6310LA16', '6300RA08', '6300DA01', '6320084C', '6320084G', '6320084B', '6320084K', '6320084Q', '6320084A', '6320084E', '63109902', '63200856', '63600001',
      // '6320084G', '6320084B', '6320084P', '6320B139', '6320084C', '63200A61', '63200851', '63200849', '6300RA08', '63200848', '6320084A', '6320084N', '6320084K', '63200B16', '6320084W', '6320084Q', '6320084E', '63200A06', '63100001', '6320B105', '632A0A63', '6320084L', '6320084M', '63200A63', '63200A75', '63200A95', '6320084F', '63200A05'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/ED_1.png`
  },
  '0xF1': {
    sn8: [ // 破壁机
      '67000001'
    ],
    imgUrl: `${imgCdnUrl.url}/cate_pic/F1_1.png`
  },
  '0xB8': {
    sn8: [ // 扫地机
      '000VR850'
    ],
    imgUrl: imgPrefix + 'plugin/0xB8/robot.png'
  },
}
const getDeviceImgAndName = (dcpDeviceImgList, category, sn8) => {
  let item = new Object()
  if (dcpDeviceImgList[category]) {
    if (dcpDeviceImgList[category][sn8]) {
      item.deviceImg = dcpDeviceImgList[category][sn8]
    } else {
      item.deviceImg = dcpDeviceImgList[category].common
    }
  } else {
    if (deviceImgMap[category]) {
      item.deviceImg = deviceImgApi.url + 'blue_' + category.toLocaleLowerCase() + '.png'
    } else {
      item.deviceImg = deviceImgApi.url + 'blue_default_type.png'
    }
  }
  if (deviceImgMap[category]) {
    const filterObj = deviceImgMap[category]
    item.deviceName = filterObj.title
  } else {
    item.deviceName = ''
  }
  return item
}
//获取明文sn
const getDeviceSn = (sn) => {
  const cipText = sn || ''
  const appKey = config.appKey[config.environment]
  const key = app.globalData.isLogin ? app.globalData.iotUserInfoData.key : ''
  const plainTextSn = cloudDecrypt(cipText, key, appKey)
  return plainTextSn
}
//获取sn8
const getDeviceSn8 = (sn) => {
  if (!sn) return ''
  return sn.substring(9, 17)
}
// 过滤colmo设备
// @TODO: 开发过程中兼容了美的设备，上线后只保留colmo
const isColmoDevice = (encodedSn = '') => {
  let decodedSn = getDeviceSn(encodedSn)
  return isColmoDeviceByDecodeSn(decodedSn)
  // return decodedSn[8] === '8' || decodedSn[8] === '1' 
}
const isColmoDeviceByDecodeSn = (decodedSn = '') => {
  return decodedSn[8] === '8'
  // return decodedSn[8] === '8' || decodedSn[8] === '1' 
}
/**
 * 查询是否为旧colmo设备
 * @param type 品类
 * @param sn8 型号
 */
const isColmoDeviceByCateAndSn8 = (type, sn8) => {
  type = type.includes('0x') ? `0x${type.substr(2, 2).toLocaleUpperCase()}` : `0x${type.toLocaleUpperCase()}`
  let isColmo = false
  if (brandConfig.allSN8List[type] && brandConfig.allSN8List[type]['sn8'].includes(sn8)) {
    isColmo = true
  }
  let filterList = app.globalData.brandConfig[app.globalData.brand].pluginFilter_SN8
  if (filterList[type] && filterList[type]['SN8'].includes(sn8)) { // colmo插件支持的sn8默认也为colmo设备（兼容新增机型）
    isColmo = true
  }
  return isColmo
}

/**
 * 查询是否为旧colmo设备
 * @param sn8 型号
 */
const isColmoDeviceBySn8 = (sn8) => {
  let isColmo = false
  Object.values(brandConfig.allSN8List).some(item => {
    if (item['sn8'] && item['sn8'].includes(sn8)) {
      isColmo = true
      return true
    }
    return false
  })
  let filterList = app.globalData.brandConfig[app.globalData.brand].pluginFilter_SN8
  Object.values(filterList).some(item => {
    if (item['SN8'] && item['SN8'].includes(sn8)) {
      isColmo = true
      return true
    }
    return false
  })
  return isColmo
}

export {
  getDeviceImgAndName,
  getDeviceSn,
  getDeviceSn8,
  isColmoDevice,
  isColmoDeviceByDecodeSn,
  isColmoDeviceBySn8,
  oldColmoSn8List
}