import{VantComponent}from"../common/component";import{pickerProps}from"./shared";VantComponent({classes:["active-class","toolbar-class","column-class"],props:Object.assign(Object.assign({},pickerProps),{valueKey:{type:String,value:"text"},toolbarPosition:{type:String,value:"top"},defaultIndex:{type:Number,value:0},columns:{type:Array,value:[],observer(columns=[]){this.simple=columns.length&&!columns[0].values,Array.isArray(this.children)&&this.children.length&&this.setColumns().catch(()=>{})}}}),beforeCreate(){Object.defineProperty(this,"children",{get:()=>this.selectAllComponents(".van-picker__column")||[]})},methods:{noop(){},setColumns(){const{data}=this,stack=(this.simple?[{values:data.columns}]:data.columns).map((column,index)=>this.setColumnValues(index,column.values));return Promise.all(stack)},emit(event){const{type}=event.currentTarget.dataset;this.simple?this.$emit(type,{value:this.getColumnValue(0),index:this.getColumnIndex(0)}):this.$emit(type,{value:this.getValues(),index:this.getIndexes()})},onChange(event){this.simple?this.$emit("change",{picker:this,value:this.getColumnValue(0),index:this.getColumnIndex(0)}):this.$emit("change",{picker:this,value:this.getValues(),index:event.currentTarget.dataset.index})},getColumn(index){return this.children[index]},getColumnValue(index){const column=this.getColumn(index);return column&&column.getValue()},setColumnValue(index,value){const column=this.getColumn(index);return column==null?Promise.reject(new Error("setColumnValue: \u5BF9\u5E94\u5217\u4E0D\u5B58\u5728")):column.setValue(value)},getColumnIndex(columnIndex){return(this.getColumn(columnIndex)||{}).data.currentIndex},setColumnIndex(columnIndex,optionIndex){const column=this.getColumn(columnIndex);return column==null?Promise.reject(new Error("setColumnIndex: \u5BF9\u5E94\u5217\u4E0D\u5B58\u5728")):column.setIndex(optionIndex)},getColumnValues(index){return(this.children[index]||{}).data.options},setColumnValues(index,options,needReset=!0){const column=this.children[index];return column==null?Promise.reject(new Error("setColumnValues: \u5BF9\u5E94\u5217\u4E0D\u5B58\u5728")):JSON.stringify(column.data.options)===JSON.stringify(options)?Promise.resolve():column.set({options}).then(()=>{needReset&&column.setIndex(0)})},getValues(){return this.children.map(child=>child.getValue())},setValues(values){const stack=values.map((value,index)=>this.setColumnValue(index,value));return Promise.all(stack)},getIndexes(){return this.children.map(child=>child.data.currentIndex)},setIndexes(indexes){const stack=indexes.map((optionIndex,columnIndex)=>this.setColumnIndex(columnIndex,optionIndex));return Promise.all(stack)}}});
