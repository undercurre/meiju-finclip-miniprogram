import{requestAnimationFrame}from"../common/utils";import{isObj}from"../common/validator";const getClassNames=name=>({enter:`van-${name}-enter van-${name}-enter-active enter-class enter-active-class`,"enter-to":`van-${name}-enter-to van-${name}-enter-active enter-to-class enter-active-class`,leave:`van-${name}-leave van-${name}-leave-active leave-class leave-active-class`,"leave-to":`van-${name}-leave-to van-${name}-leave-active leave-to-class leave-active-class`});export function transition(showDefaultValue){return Behavior({properties:{customStyle:String,show:{type:Boolean,value:showDefaultValue,observer:"observeShow"},duration:{type:null,value:300,observer:"observeDuration"},name:{type:String,value:"fade"}},data:{type:"",inited:!1,display:!1},ready(){this.data.show===!0&&this.observeShow(!0,!1)},methods:{observeShow(value,old){value!==old&&(value?this.enter():this.leave())},enter(){const{duration,name}=this.data,classNames=getClassNames(name),currentDuration=isObj(duration)?duration.enter:duration;this.status="enter",this.$emit("before-enter"),requestAnimationFrame(()=>{this.status==="enter"&&(this.$emit("enter"),this.setData({inited:!0,display:!0,classes:classNames.enter,currentDuration}),requestAnimationFrame(()=>{this.status==="enter"&&(this.transitionEnded=!1,this.setData({classes:classNames["enter-to"]}))}))})},leave(){if(!this.data.display)return;const{duration,name}=this.data,classNames=getClassNames(name),currentDuration=isObj(duration)?duration.leave:duration;this.status="leave",this.$emit("before-leave"),requestAnimationFrame(()=>{this.status==="leave"&&(this.$emit("leave"),this.setData({classes:classNames.leave,currentDuration}),requestAnimationFrame(()=>{this.status==="leave"&&(this.transitionEnded=!1,setTimeout(()=>this.onTransitionEnd(),currentDuration),this.setData({classes:classNames["leave-to"]}))}))})},onTransitionEnd(){if(this.transitionEnded)return;this.transitionEnded=!0,this.$emit(`after-${this.status}`);const{show,display}=this.data;!show&&display&&this.setData({display:!1})}}})}
